## Проект: Telegram-бот KDKPBot для учёта дропа и монет в Lineage 2

### Цель

Создать Telegram-бота для клана в Lineage 2, который заменит систему DKP учётом рейдов, дропа, продаж и дележа выручки в L Монетах. Учитываются только рейды на Фринтезу. Всё строго по TDD. Код покрыт тестами, работает через CI/CD, деплоится на сервер через systemd.

---

### Функции для соклана:

* Привязка Telegram к никнейму в игре
* Просмотр рейдов, в которых он участвовал
* Просмотр дропа, выставленного на продажу (только из своих рейдов)
* Просмотр проданных, но ещё не поделённых предметов
* Просмотр баланса доступных L Монет
* Создание заявки на выплату монет
* Подтверждение выставления итемов на рынок

### Функции для админа:

* Создание рейда (только Фринтеза)
* Добавление участников
* Учёт дропа с рейда
* Учёт выставления дропа на рынок
* Подтверждение продажи итема
* Подтверждение заявки на монеты от соклана (с проверкой выставленных предметов и списанием монет с баланса)

---

### Архитектура

* Telegram Bot API через `python-telegram-bot`
* .env для хранения токенов и настроек
* Хранение данных (позже: БД, Google Sheets только как витрина)
* Монеты считаются по проданным предметам
* Баланс пользователя = сумма долей от проданных предметов по участию в рейдах

---

### Разработка

* Test-Driven Development (TDD)
* 100% покрытие тестами `pytest`
* Использование Poetry
* CI через GitHub Actions
* Автодеплой на сервер через SSH
* systemd-сервис на сервере
* Docker (локальная разработка и деплой)
* Мониторинг состояния сервиса

---

### Ограничения

* До 40 человек в клане, до 20 активных участников
* Без кэширования
* Таблицы могут редактироваться вручную

---

### Следующие шаги

1. Реализация привязки Telegram к никнейму (TDD)
2. Учёт рейда (дата, участники)
3. Учёт дропа (привязка к рейду)
4. Учёт продажи дропа и расчёт баланса
5. Запрос монет и процесс выплаты (вкл. подтверждения)
6. Интерфейсы: Telegram-команды и кнопки по ролям
7. Вывод информации для соклана
8. Вывод информации для админа

---

*Документ обновляется по мере развития проекта.*
